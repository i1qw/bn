## Binance USDT-M Futures Trading Bot

## 项目简介

这是一个基于币安API开发的U本位合约自动交易系统，采用中高频率趋势跟踪策略，主要针对山寨币市场。系统包含自动交易主程序和主动止盈监控器，可以实现自动开仓、止损跟踪和智能止盈等功能。

## 系统架构

系统由以下核心模块组成：

1. **主交易模块** (`binance_main.py`) - 负责交易策略执行、订单管理和止损跟踪
2. **止盈监控模块** (`binance_take_profit.py`) - 独立运行的止盈监控器，实现主动止盈功能
3. **时间同步管理器** (`time_sync_config.py`) - 确保本地时间与币安服务器时间同步，避免API请求错误
4. **配置模块** (`config.py`) - 集中管理API密钥和交易参数
5. **启动脚本** (`run_binance_bot.bat`) - 一键启动整个交易系统

## 核心功能特性

### 1. 交易策略

- **1小时交易周期** - 以1小时K线为主要交易周期，适合中高频率的趋势跟踪
- **动态交易对选择** - 自动监控并选择交易量排名前28的USDT永续合约（排除主流币）
- **移动平均线交叉策略** - 基于MA20和MA60的突破信号判断买入/卖出时机
- **自适应杠杆管理** - 根据交易方向自动设置不同的杠杆倍数
- **精确仓位计算** - 自动计算符合交易对最小交易量和价格精度要求的订单数量

### 2. 风险管理

- **移动止损** - 开仓后设置初始止损，并在价格有利变动时自动更新止损位
- **条件止损更新** - 当小时K线涨跌幅达到预设条件时触发止损位调整
- **单向持仓模式** - 自动设置账户为单向持仓模式，简化交易逻辑

### 3. 智能止盈

- **独立止盈监控** - 单独运行的止盈程序，5分钟检查一次所有持仓
- **比例止盈** - 当价格达到开仓价的指定倍数（默认1.3倍）时自动平掉一半仓位
- **止盈记录跟踪** - 避免对同一币种重复执行止盈操作

### 4. 系统优化

- **时间同步管理** - 自动与币安服务器时间同步，避免时间戳错误
- **请求重试机制** - 网络请求失败时自动重试，提高系统稳定性
- **错误处理** - 完善的异常捕获和错误处理机制

## 技术栈

- **编程语言**: Python 3.8+
- **核心库**:
  - `python-binance` - 币安API官方SDK
  - `pandas` - 数据处理和分析
  - `requests` - HTTP请求
  - `threading` - 多线程支持

## 快速开始

### 1. 环境准备

```bash
# 安装依赖
pip install python-binance pandas requests
```

### 2. 配置设置

编辑 `config.py` 文件，进行以下配置：

```python
# API密钥配置
API_KEY = '您的币安API密钥'
API_SECRET = '您的币安API密钥'

# 交易参数
LONG_LEVERAGE = 10  # 多单杠杆
SHORT_LEVERAGE = 10  # 空单杠杆
LONG_AMOUNT = 200  # 多单保证金金额(USDT)
SHORT_AMOUNT = 200  # 空单保证金金额(USDT)

# 排除的交易对列表
exclude_symbols = ["BTCUSDT", "ETHUSDT", ...]  # 主流币会被排除
```

### 3. 启动系统

#### 方式一：使用批处理脚本（推荐）

双击 `run_binance_bot.bat` 文件，系统会自动：
- 检查并安装依赖
- 创建日志目录
- 启动主交易策略和止盈监控器

#### 方式二：手动启动

1. 启动主交易策略：
   ```bash
   python binance_main.py
   ```

2. 启动止盈监控器：
   ```bash
   python binance_take_profit.py
   ```

## 详细功能说明

### 主交易模块 (binance_main.py) 核心类: BinanceFuturesTrader

- **初始化** - 连接API、设置交易参数、获取交易对列表
- **交易对管理** - 自动获取并更新高交易量的交易对
- **K线数据处理** - 获取并分析K线数据，计算移动平均线指标
- **信号判断** - 根据均线交叉判断买卖信号
- **订单管理** - 下单、设置止损、更新止损
- **仓位管理** - 检查和处理现有持仓

### 止盈监控模块 (binance_take_profit.py) 核心类: TakeProfitMonitor

- **定期检查** - 每5分钟检查一次所有持仓
- **利润计算** - 监控价格变化，计算相对开仓价的涨幅倍数
- **止盈执行** - 当达到预设止盈倍数时，自动平掉一半仓位

### 时间同步管理器 (time_sync_config.py) 核心类: TimeSyncManager

- **自动同步** - 每小时自动与币安服务器时间同步
- **时间偏移计算** - 计算并补偿网络延迟和时间差异
- **同步时间戳获取** - 提供同步后的时间戳用于API请求

## 运行流程

### 1. 系统初始化

- 连接币安API
- 设置账户为单向持仓模式
- 获取交易量前28的交易对

### 2. 交易监控循环

系统采用精准的时间触发机制，在每小时的特定时间点执行不同任务：

- **每小时第57分钟**: 检查所有订单执行情况，确保订单状态正常
- **每小时第58分钟**: 更新交易量前28的交易对列表，保持交易标的的时效性和流动性
- **每小时第59分钟**: 执行核心交易策略逻辑，包括：
  - 获取当前所有持仓信息
  - 检查并撤销已平仓但仍存在的关联订单
  - 更新所有持仓的止损位，实现移动止损功能
  - 合并监控列表：前28交易对 + 当前持仓交易对（去重）
  - 对每个交易对进行技术分析，判断开仓信号
  - 根据信号执行开仓或平仓操作
  - 为新开仓位设置初始止损单

### 3. 止盈监控

- 独立线程定期检查所有持仓
- 当达到止盈条件时，平掉一半仓位

## 注意事项

### 1. API权限设置

请确保您的币安API具有以下权限：
- 读取账户信息
- 读取行情数据
- 交易权限（创建订单、取消订单）

### 2. 风险控制

- 系统默认使用10倍杠杆，请根据自身风险承受能力调整
- 交易有风险，建议先用小额资金测试

### 3. 主流币排除

- 系统默认排除BTC、ETH等主流币，适合交易山寨币
- 可通过修改 `exclude_symbols` 配置调整排除列表

## 故障排除

| 问题描述 | 解决方案 |
|---------|----------|
| 时间同步错误（错误码1021） | 系统会自动重新同步时间 |
| API连接问题 | 系统包含请求重试机制，网络暂时中断后会自动恢复 |
| 订单执行失败 | 检查API权限和账户资金是否充足 |

## 许可证

本项目仅供学习和研究使用，不构成投资建议。使用本系统产生的任何盈亏均由用户自行承担。

## 贡献

欢迎提交Issues和Pull Requests来改进系统。

---

**免责声明**：加密货币交易具有高风险性，本系统不保证盈利，请谨慎使用！
